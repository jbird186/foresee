#include "src/lex.4c"
#include "src/preprocess.4c"
#include "src/parse.4c"
#include "src/compile.4c"

:main {
    $src_fd REF
    &src_file_name 0 fopen &src_fd!

    if &src_fd@ is_failure {
        "ERROR: File '".s &src_file_name.s "' not found\n".s
        1 exit
    }

    &src_str SRC_STR_SIZE &src_fd@ fread drop
    &src_fd@ fclose drop

    &src_str lex_src
    preprocess_src
    parse_out_toks

    &out_file_name 1 fopen &out_fd!
    compile_program
    &out_fd@ fclose drop
}